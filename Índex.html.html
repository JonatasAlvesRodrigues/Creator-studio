<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Studio Pro | Master Agency</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f1f5f9; overflow-x: hidden; }
        .glass-card { background: rgba(15, 23, 42, 0.7); border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
        .tab-active { background: #6366f1 !important; color: white !important; box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.5); }
        #prompter-scroll { transition: transform 0.1s linear; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="min-h-screen">

    <div id="login-screen" class="fixed inset-0 flex items-center justify-center bg-[#020617] z-[200]">
        <div class="bg-slate-900/40 p-12 rounded-[3.5rem] border border-white/5 text-center max-w-sm w-full backdrop-blur-3xl shadow-2xl">
            <div class="w-20 h-20 bg-indigo-600 rounded-3xl mx-auto mb-8 flex items-center justify-center rotate-12 shadow-lg shadow-indigo-600/40">
                <i data-lucide="shield-check" class="text-white w-10 h-10 -rotate-12"></i>
            </div>
            <h1 class="text-3xl font-black mb-2 text-white italic tracking-tighter">STUDIO ACCESS</h1>
            <p class="text-slate-500 font-bold text-[10px] mb-10 uppercase tracking-[0.3em]">Identifique-se para continuar</p>
            <div class="space-y-4">
                <input type="text" id="username" placeholder="@seu-usuario" class="w-full p-5 bg-slate-950/50 border border-slate-800 rounded-2xl text-white outline-none focus:ring-2 ring-indigo-500 transition-all text-center font-bold">
                <button onclick="tentarLogin()" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl hover:bg-indigo-500 transition-all active:scale-95">Entrar no Painel</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden flex min-h-screen">
        <aside class="w-72 bg-slate-950 border-r border-slate-900 flex flex-col p-8 fixed h-full z-40">
            <div class="mb-12 px-4 text-2xl font-black text-white italic tracking-tighter flex items-center gap-2">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg"></div> C.I. STUDIO
            </div>
            <nav class="flex-1 space-y-3">
                <button onclick="mudarAba('dash')" id="btn-dash" class="w-full text-left p-4 rounded-2xl flex items-center font-bold text-slate-500 hover:bg-slate-900 transition-all"><i data-lucide="layout-grid" class="mr-4 w-5"></i> Dashboard</button>
                <button onclick="mudarAba('ai')" id="btn-ai" class="w-full text-left p-4 rounded-2xl flex items-center font-bold text-purple-400 hover:bg-slate-900 transition-all"><i data-lucide="sparkles" class="mr-4 w-5"></i> IA Estrategista</button>
                <button onclick="mudarAba('videos')" id="btn-videos" class="w-full text-left p-4 rounded-2xl flex items-center font-bold text-slate-500 hover:bg-slate-900 transition-all"><i data-lucide="play-circle" class="mr-4 w-5"></i> Conteúdo</button>
                <button onclick="mudarAba('calendar')" id="btn-calendar" class="w-full text-left p-4 rounded-2xl flex items-center font-bold text-slate-500 hover:bg-slate-900 transition-all"><i data-lucide="calendar" class="mr-4 w-5"></i> Cronograma</button>
            </nav>
            <button onclick="sair()" class="mt-auto flex items-center gap-3 p-4 text-slate-600 font-bold text-xs uppercase hover:text-red-500 transition"><i data-lucide="power" class="w-4"></i> Encerrar Sessão</button>
        </aside>

        <main class="flex-1 ml-72 flex flex-col bg-[#020617] min-h-screen">
            <header class="h-24 border-b border-slate-900 flex items-center justify-between px-12 sticky top-0 bg-[#020617]/80 backdrop-blur-md z-30">
                <div id="header-context">
                    <h2 id="titulo-pagina" class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em]">Overview</h2>
                    <p id="data-atual" class="text-xs text-slate-600 font-bold mt-1 uppercase"></p>
                </div>
                <div class="flex items-center gap-4">
                    <div id="user-info" class="bg-slate-900 px-5 py-2.5 rounded-full text-[10px] font-black text-white uppercase border border-slate-800 tracking-widest"></div>
                </div>
            </header>
            <div id="conteudo-dinamico" class="p-12 flex-1"></div>
        </main>
    </div>

    <div id="modal-business" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-slate-950/98 backdrop-blur-2xl">
        <div class="bg-slate-900 w-full max-w-4xl rounded-[3rem] shadow-2xl flex flex-col h-[80vh] border border-slate-800 overflow-hidden">
            <div class="p-8 border-b border-slate-800 flex justify-between items-center bg-slate-900/50">
                <h3 class="text-xl font-black text-white italic tracking-tighter uppercase">Campaign & ROI</h3>
                <button onclick="fecharBusiness()" class="bg-slate-800 p-2.5 rounded-xl text-white hover:bg-red-500 transition-all"><i data-lucide="x" class="w-5"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto p-10 grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="space-y-6">
                    <label class="block text-[10px] text-slate-500 font-black uppercase">Marca/Job</label>
                    <input type="text" id="biz-marca" class="w-full p-4 bg-slate-800 rounded-xl text-white outline-none border border-transparent focus:border-indigo-500">
                    <label class="block text-[10px] text-slate-500 font-black uppercase">Investimento (R$)</label>
                    <input type="number" id="biz-valor" oninput="calcularCPM()" class="w-full p-4 bg-slate-800 rounded-xl text-white outline-none">
                </div>
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-[10px] text-slate-500 font-bold uppercase">Views</label><input type="number" id="met-views" oninput="calcularCPM()" class="w-full p-4 bg-slate-800 rounded-xl text-white outline-none"></div>
                        <div><label class="text-[10px] text-slate-500 font-bold uppercase">Likes</label><input type="number" id="met-likes" class="w-full p-4 bg-slate-800 rounded-xl text-white outline-none"></div>
                    </div>
                    <div class="bg-slate-950 p-6 rounded-2xl border border-slate-800 text-center">
                        <p class="text-[9px] text-slate-600 font-black uppercase mb-1">CPM</p>
                        <h5 id="val-cpm" class="text-2xl font-black text-emerald-500">R$ 0,00</h5>
                    </div>
                    <button onclick="salvarMetricas()" class="w-full bg-emerald-600 py-4 rounded-xl font-black uppercase text-[10px] tracking-widest text-white hover:bg-emerald-500 transition-all">Salvar Dados</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-roteiro" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-slate-950/95 backdrop-blur-xl">
        <div id="container-roteiro" class="bg-slate-900 w-full max-w-6xl rounded-[3.5rem] shadow-2xl flex flex-col h-[90vh] border border-slate-800 overflow-hidden transition-all duration-500">
            <div class="p-8 border-b border-slate-800 flex justify-between items-center bg-slate-900/50">
                <div class="flex items-center gap-6">
                    <h3 id="modal-titulo-video" class="text-xl font-black text-white italic">Roteiro</h3>
                    <div class="flex bg-slate-800 p-1 rounded-xl">
                        <button id="btn-edit" onclick="setModoStudio('edit')" class="px-5 py-2 rounded-lg text-[9px] font-black uppercase bg-indigo-600 transition-all">Editor</button>
                        <button id="btn-prompt" onclick="setModoStudio('prompt')" class="px-5 py-2 rounded-lg text-[9px] font-black uppercase text-slate-400 transition-all">Prompter</button>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="baixarRoteiroPDF()" class="flex items-center gap-2 bg-slate-800 hover:bg-slate-700 text-white px-4 py-2.5 rounded-xl text-[9px] font-black uppercase transition-all"><i data-lucide="download" class="w-4"></i> PDF</button>
                    <button onclick="fecharRoteiro()" class="bg-slate-800 p-2.5 rounded-xl text-white hover:bg-red-500 transition"><i data-lucide="x" class="w-4"></i></button>
                </div>
            </div>
            <textarea id="editor-texto" oninput="salvarRoteiroTexto()" class="flex-1 p-12 text-xl bg-transparent text-slate-200 outline-none resize-none leading-relaxed font-mono" placeholder="Escreva aqui..."></textarea>
            <div id="area-prompter" class="hidden flex-1 overflow-hidden relative bg-black">
                <div id="prompter-scroll" class="absolute top-0 left-0 w-full p-20 text-center text-5xl font-bold text-white leading-loose select-none whitespace-pre-wrap"></div>
                <div class="absolute inset-0 pointer-events-none flex items-center justify-center"><div class="w-full h-40 border-y-2 border-indigo-500/30 bg-indigo-500/5"></div></div>
                <div class="absolute bottom-10 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur p-4 rounded-3xl border border-white/10 flex items-center gap-8 z-50">
                    <div class="flex items-center gap-3"><span class="text-[9px] font-black text-slate-500 uppercase">Speed</span><input type="range" id="prompter-speed" min="1" max="15" value="5" class="w-24 accent-indigo-500"></div>
                    <button onclick="togglePrompter()" id="btn-play-prompt" class="bg-indigo-600 w-10 h-10 rounded-full flex items-center justify-center hover:scale-110 transition"><i data-lucide="play" id="icon-play" class="w-4 fill-white text-white"></i></button>
                    <span class="text-[9px] font-black text-slate-600 uppercase">Space = Play</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('ch_db')) || { usuarios: {} };
        let usuarioAtivo = sessionStorage.getItem('ch_user');
        let indexSendoEditado = null;
        let prompterInterval = null;
        let prompterPos = 300;
        let isPrompterRunning = false;
        let filtroRede = 'Todos';

        const salvar = () => localStorage.setItem('ch_db', JSON.stringify(db));

        // AUTH SYSTEM
        function tentarLogin() {
            const u = document.getElementById('username').value.trim().toLowerCase();
            if (u) {
                if (!db.usuarios[u]) db.usuarios[u] = { videos: [] };
                sessionStorage.setItem('ch_user', u);
                location.reload();
            }
        }
        function sair() { sessionStorage.clear(); location.reload(); }

        // NAVIGATION
        function mudarAba(aba) {
            const container = document.getElementById('conteudo-dinamico');
            document.getElementById('titulo-pagina').innerText = aba.toUpperCase();
            ['dash', 'videos', 'calendar', 'ai'].forEach(id => {
                const btn = document.getElementById('btn-' + id);
                if(btn) btn.classList.toggle('tab-active', id === aba);
            });
            container.innerHTML = "";
            const user = db.usuarios[usuarioAtivo];
            if (aba === 'dash') renderDash(user);
            if (aba === 'ai') renderAIScreen();
            if (aba === 'videos') renderVideos(user);
            if (aba === 'calendar') renderCalendar();
            lucide.createIcons();
        }

        // VIDEOS WITH PLATFORM FILTERS
        function renderVideos(user) {
            const videosFiltrados = filtroRede === 'Todos' ? user.videos : user.videos.filter(v => v.rede === filtroRede);
            
            document.getElementById('conteudo-dinamico').innerHTML = `
                <div class="flex flex-col gap-10 animate-in fade-in duration-500">
                    <div class="flex justify-between items-end">
                        <div class="flex gap-3 p-1.5 bg-slate-950 rounded-2xl border border-slate-900 w-fit">
                            ${['Todos', 'TikTok', 'Instagram', 'YouTube'].map(rede => `
                                <button onclick="setFiltro('${rede}')" class="px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${filtroRede === rede ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500 hover:text-white'}">
                                    ${rede}
                                </button>
                            `).join('')}
                        </div>
                        <button onclick="addVideo()" class="bg-indigo-600 px-8 py-3.5 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:scale-105 transition-all shadow-lg shadow-indigo-600/20">+ Novo Post</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${videosFiltrados.map((v, i) => `
                            <div class="glass-card p-8 rounded-[2.5rem] border-t-4 ${getColorRede(v.rede)} group">
                                <div class="flex justify-between items-start mb-6">
                                    <span class="text-[9px] font-black px-3 py-1 bg-slate-800 text-slate-400 rounded-lg uppercase tracking-widest">${v.rede}</span>
                                    <button onclick="deletarVideo(${user.videos.indexOf(v)})" class="text-slate-800 hover:text-red-500 transition opacity-0 group-hover:opacity-100"><i data-lucide="trash-2" class="w-4"></i></button>
                                </div>
                                <h4 class="text-xl font-bold text-white mb-8 leading-tight line-clamp-2">${v.titulo}</h4>
                                <div class="flex gap-2 mb-8">
                                    <button onclick="abrirRoteiro(${user.videos.indexOf(v)})" class="flex-1 bg-indigo-600/10 text-indigo-400 py-3 rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-indigo-600 hover:text-white transition-all">Studio</button>
                                    <button onclick="abrirBusiness(${user.videos.indexOf(v)})" class="px-4 py-3 bg-slate-800 rounded-xl text-slate-400 hover:text-white transition-all"><i data-lucide="dollar-sign" class="w-4"></i></button>
                                </div>
                                <div class="grid grid-cols-2 gap-3 pt-6 border-t border-slate-900/50">
                                    ${renderCheck(user.videos.indexOf(v), 'p1', 'Roteiro', v.p1)}
                                    ${renderCheck(user.videos.indexOf(v), 'p2', 'Gravação', v.p2)}
                                    ${renderCheck(user.videos.indexOf(v), 'p3', 'Edição', v.p3)}
                                    ${renderCheck(user.videos.indexOf(v), 'p4', 'Postado', v.p4)}
                                </div>
                            </div>
                        `).join('')}
                        ${videosFiltrados.length === 0 ? `<div class="col-span-full py-20 text-center text-slate-700 font-bold uppercase tracking-widest text-xs">Vazio por aqui...</div>` : ''}
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function getColorRede(rede) {
            const cores = { 'TikTok': 'border-pink-600', 'Instagram': 'border-purple-500', 'YouTube': 'border-red-600' };
            return cores[rede] || 'border-slate-800';
        }

        function setFiltro(rede) { filtroRede = rede; mudarAba('videos'); }

        function renderCheck(idx, campo, label, status) {
            return `<div onclick="toggleStatus(${idx}, '${campo}')" class="flex items-center gap-3 cursor-pointer">
                <div class="w-5 h-5 rounded-md border-2 ${status ? 'bg-indigo-600 border-indigo-600' : 'border-slate-800'} flex items-center justify-center transition-all shadow-sm">
                    ${status ? '<i data-lucide="check" class="w-3 text-white"></i>' : ''}
                </div>
                <span class="text-[9px] font-black ${status ? 'text-slate-700' : 'text-slate-500'} uppercase">${label}</span>
            </div>`;
        }

        function addVideo() {
            const t = prompt("Título do post:");
            if(!t) return;
            const r = prompt("Rede (TikTok, Instagram ou YouTube):", "TikTok");
            const redes = ['TikTok', 'Instagram', 'YouTube'];
            const redeFinal = redes.includes(r) ? r : 'TikTok';
            db.usuarios[usuarioAtivo].videos.push({ titulo: t, rede: redeFinal, data: new Date().toISOString().split('T')[0], roteiro: "", p1:false, p2:false, p3:false, p4:false, valor:0, m_views:0, m_likes:0 });
            salvar(); mudarAba('videos');
        }

        // --- DASHBOARD ---
        function renderDash(user) {
            const vds = user.videos;
            const receita = vds.reduce((acc, v) => acc + (parseFloat(v.valor) || 0), 0);
            const totalViews = vds.reduce((acc, v) => acc + (parseInt(v.m_views) || 0), 0);
            document.getElementById('conteudo-dinamico').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12 animate-in slide-in-from-bottom-4 duration-700">
                    <div class="bg-indigo-600 p-10 rounded-[2.5rem] col-span-2 shadow-xl shadow-indigo-600/20">
                        <p class="text-indigo-200 text-[10px] font-black uppercase tracking-widest mb-2">Faturamento Anual</p>
                        <h3 class="text-5xl font-black text-white italic">R$ ${receita.toLocaleString('pt-BR')}</h3>
                    </div>
                    <div class="glass-card p-10 rounded-[2.5rem] flex flex-col justify-center">
                        <p class="text-slate-500 text-[10px] font-black uppercase mb-1">Total Views</p>
                        <p class="text-3xl font-black text-white">${totalViews >= 1000 ? (totalViews/1000).toFixed(1)+'K' : totalViews}</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="glass-card p-10 rounded-[2.5rem]">
                        <h4 class="text-white font-black text-[10px] uppercase mb-8 tracking-widest">Atividade Recente</h4>
                        <div class="space-y-4">
                            ${vds.slice(-4).reverse().map(v=>`
                                <div class="flex justify-between items-center p-5 bg-slate-950/40 rounded-2xl border border-slate-900">
                                    <span class="text-xs font-bold text-white">${v.titulo}</span>
                                    <span class="text-[9px] font-black px-2 py-1 bg-indigo-500/10 text-indigo-400 rounded-md uppercase">${v.rede}</span>
                                </div>
                            `).join('') || '<p class="text-slate-600 text-xs">Nenhum projeto ainda.</p>'}
                        </div>
                    </div>
                    <div class="bg-indigo-900/10 border border-indigo-500/10 p-10 rounded-[2.5rem] text-center flex flex-col items-center justify-center">
                        <i data-lucide="download" class="text-indigo-500 w-8 h-8 mb-4"></i>
                        <h4 class="text-white font-black uppercase text-xs mb-6">Media Kit Profissional</h4>
                        <button onclick="gerarMediaKit()" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest transition hover:scale-105">Baixar PDF</button>
                    </div>
                </div>
            `;
        }

        // --- IA SCREEN ---
        function renderAIScreen() {
            document.getElementById('conteudo-dinamico').innerHTML = `
                <div class="max-w-3xl mx-auto animate-in fade-in duration-700">
                    <div class="bg-gradient-to-br from-indigo-900 via-slate-950 to-slate-950 p-12 rounded-[3rem] border border-white/5">
                        <h3 class="text-2xl font-black italic text-white uppercase mb-8 flex items-center gap-3"><i data-lucide="zap" class="text-indigo-400"></i> IA Strategist</h3>
                        <div class="space-y-4">
                            <input type="text" id="ai-tema" placeholder="Sobre o que vamos criar hoje?" class="w-full p-5 bg-slate-950 border border-slate-800 rounded-2xl text-white outline-none focus:ring-2 ring-indigo-500 transition-all">
                            <div class="grid grid-cols-2 gap-4">
                                <select id="ai-estilo" class="bg-slate-800 p-4 rounded-xl text-[10px] font-black text-white border-none outline-none">
                                    <option value="viral">Viral (Hook Forte)</option>
                                    <option value="story">Storytelling (Emocional)</option>
                                    <option value="tutorial">Tutorial (Autoridade)</option>
                                </select>
                                <button onclick="gerarIA()" class="bg-indigo-600 text-white py-4 rounded-xl font-black uppercase text-[10px] tracking-widest hover:bg-indigo-500">Gerar Script</button>
                            </div>
                        </div>
                    </div>
                    <div id="ai-output" class="mt-8"></div>
                </div>
            `;
            lucide.createIcons();
        }

        function gerarIA() {
            const tema = document.getElementById('ai-tema').value;
            const estilo = document.getElementById('ai-estilo').value;
            const out = document.getElementById('ai-output');
            if (!tema) return alert("Digite um tema!");
            out.innerHTML = `<div class="p-10 text-center"><div class="w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div><p class="text-indigo-400 font-bold uppercase text-[10px]">Consultando tendências...</p></div>`;
            setTimeout(() => {
                const roteiros = {
                    viral: { h: `O segredo de ${tema} que ninguém te conta.`, b: `A maioria das pessoas falha com ${tema} porque foca no lugar errado. Se você fizer isso aqui...`, c: `Comenta "QUERO" para o guia completo.` },
                    story: { h: `Como ${tema} salvou meu ano.`, b: `Eu estava perdido em ${tema} até que percebi uma coisa simples: menos é mais.`, c: `Salva esse vídeo para não esquecer.` },
                    tutorial: { h: `Guia prático de ${tema} em 3 passos.`, b: `Passo 1: Comece pela base. Passo 2: Aplique a técnica de repetição. Passo 3: Analise seus resultados de ${tema}.`, c: `Me segue para mais dicas!` }
                };
                const r = roteiros[estilo];
                out.innerHTML = `
                    <div class="glass-card p-10 rounded-[2.5rem] border-t-4 border-indigo-600 shadow-2xl animate-in zoom-in duration-500">
                        <div class="space-y-6">
                            <div><span class="text-[9px] font-black text-indigo-500 uppercase">Hook</span><p id="res-hook" class="text-lg text-white font-bold italic">${r.h}</p></div>
                            <div><span class="text-[9px] font-black text-purple-500 uppercase">Script</span><p id="res-body" class="text-slate-400 text-sm leading-relaxed">${r.b}</p></div>
                            <div><span class="text-[9px] font-black text-emerald-500 uppercase">CTA</span><p id="res-cta" class="text-slate-200 font-bold text-sm">${r.c}</p></div>
                        </div>
                        <button onclick="importarIAParaProjeto()" class="w-full mt-8 bg-white text-slate-900 py-4 rounded-xl font-black uppercase text-[10px] tracking-widest hover:bg-indigo-500 hover:text-white transition-all">Importar para Roteiros</button>
                    </div>
                `;
            }, 1200);
        }

        function importarIAParaProjeto() {
            const h = document.getElementById('res-hook').innerText, b = document.getElementById('res-body').innerText, c = document.getElementById('res-cta').innerText, t = document.getElementById('ai-tema').value;
            db.usuarios[usuarioAtivo].videos.push({ titulo: `IA: ${t}`, rede: "TikTok", data: new Date().toISOString().split('T')[0], roteiro: `GANCHO:\n${h}\n\nCONTEÚDO:\n${b}\n\nCTA:\n${c}`, p1:true, p2:false, p3:false, p4:false, valor:0, m_views:0, m_likes:0 });
            salvar(); mudarAba('videos');
        }

        // --- STUDIO LOGIC (PROMPTER & EDIT) ---
        function setModoStudio(modo) {
            const edit = document.getElementById('editor-texto'), prompt = document.getElementById('area-prompter'), bEdit = document.getElementById('btn-edit'), bPrompt = document.getElementById('btn-prompt'), cont = document.getElementById('container-roteiro');
            if (modo === 'prompt') {
                document.getElementById('prompter-scroll').innerText = edit.value || "Sem texto...";
                edit.classList.add('hidden'); prompt.classList.remove('hidden');
                bPrompt.classList.replace('text-slate-400', 'bg-indigo-600'); bEdit.classList.replace('bg-indigo-600', 'text-slate-400');
                cont.classList.add('max-w-full', 'h-screen', 'rounded-none'); prompterPos = 300; atualizarPosicaoPrompter();
            } else {
                pararPrompter(); edit.classList.remove('hidden'); prompt.classList.add('hidden');
                bEdit.classList.replace('text-slate-400', 'bg-indigo-600'); bPrompt.classList.replace('bg-indigo-600', 'text-slate-400');
                cont.classList.remove('max-w-full', 'h-screen', 'rounded-none');
            }
            lucide.createIcons();
        }
        function togglePrompter() { isPrompterRunning ? pararPrompter() : iniciarPrompter(); }
        function iniciarPrompter() {
            isPrompterRunning = true; document.getElementById('icon-play').setAttribute('data-lucide', 'pause'); lucide.createIcons();
            prompterInterval = setInterval(() => { prompterPos -= document.getElementById('prompter-speed').value / 4; atualizarPosicaoPrompter(); }, 16);
        }
        function pararPrompter() { isPrompterRunning = false; clearInterval(prompterInterval); document.getElementById('icon-play').setAttribute('data-lucide', 'play'); lucide.createIcons(); }
        function atualizarPosicaoPrompter() { document.getElementById('prompter-scroll').style.transform = `translateY(${prompterPos}px)`; }
        function abrirRoteiro(i) { indexSendoEditado = i; const v = db.usuarios[usuarioAtivo].videos[i]; document.getElementById('modal-titulo-video').innerText = v.titulo; document.getElementById('editor-texto').value = v.roteiro || ""; document.getElementById('modal-roteiro').classList.remove('hidden'); setModoStudio('edit'); }
        function fecharRoteiro() { document.getElementById('modal-roteiro').classList.add('hidden'); mudarAba('videos'); }
        function salvarRoteiroTexto() { db.usuarios[usuarioAtivo].videos[indexSendoEditado].roteiro = document.getElementById('editor-texto').value; salvar(); }
        function baixarRoteiroPDF() {
            const t = document.getElementById('modal-titulo-video').innerText, txt = document.getElementById('editor-texto').value;
            const h = `<div style="padding:40px; font-family:sans-serif;"><h1 style="color:#6366f1;">${t}</h1><div style="white-space:pre-wrap; font-size:14px; margin-top:20px;">${txt}</div></div>`;
            html2pdf().from(h).save(`Roteiro_${t}.pdf`);
        }

        // --- BUSINESS & CALENDAR ---
        function abrirBusiness(i) { indexSendoEditado = i; const v = db.usuarios[usuarioAtivo].videos[i]; document.getElementById('biz-marca').value = v.marca || ""; document.getElementById('biz-valor').value = v.valor || ""; document.getElementById('met-views').value = v.m_views || ""; document.getElementById('met-likes').value = v.m_likes || ""; calcularCPM(); document.getElementById('modal-business').classList.remove('hidden'); }
        function calcularCPM() { const v = parseFloat(document.getElementById('biz-valor').value) || 0, view = parseInt(document.getElementById('met-views').value) || 0; document.getElementById('val-cpm').innerText = `R$ ${view > 0 ? (v / (view / 1000)).toFixed(2) : "0,00"}`; }
        function salvarMetricas() { const v = db.usuarios[usuarioAtivo].videos[indexSendoEditado]; v.marca = document.getElementById('biz-marca').value; v.valor = document.getElementById('biz-valor').value; v.m_views = document.getElementById('met-views').value; v.m_likes = document.getElementById('met-likes').value; salvar(); fecharBusiness(); }
        function fecharBusiness() { document.getElementById('modal-business').classList.add('hidden'); mudarAba('videos'); }
        function toggleStatus(idx, campo) { db.usuarios[usuarioAtivo].videos[idx][campo] = !db.usuarios[usuarioAtivo].videos[idx][campo]; salvar(); mudarAba('videos'); }
        function deletarVideo(i) { if(confirm("Remover este projeto?")) { db.usuarios[usuarioAtivo].videos.splice(i,1); salvar(); mudarAba('videos'); } }
        function renderCalendar() {
            const m = ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"], d = new Date();
            document.getElementById('conteudo-dinamico').innerHTML = `
                <div class="glass-card rounded-[2.5rem] p-10 animate-in fade-in duration-500 text-center">
                    <h3 class="text-2xl font-black text-white uppercase mb-10">${m[d.getMonth()]} ${d.getFullYear()}</h3>
                    <div class="grid grid-cols-7 gap-4">
                        ${Array.from({length: 31}, (_, i) => {
                            const tem = db.usuarios[usuarioAtivo].videos.some(v => new Date(v.data).getDate() === i+1);
                            return `<div class="aspect-square bg-slate-900/50 rounded-2xl border ${tem ? 'border-indigo-500/50 bg-indigo-500/5' : 'border-slate-800'} flex items-center justify-center font-bold text-xs ${tem ? 'text-indigo-400' : 'text-slate-700'}">${i+1}</div>`;
                        }).join('')}
                    </div>
                </div>`;
        }
        function gerarMediaKit() {
            const u = db.usuarios[usuarioAtivo], views = u.videos.reduce((acc, v) => acc + (parseInt(v.m_views) || 0), 0);
            const h = `<div style="padding:60px; font-family:sans-serif; background:#020617; color:white; min-height:800px; text-align:center;">
                <h1>${usuarioAtivo.toUpperCase()}</h1><p style="color:#6366f1;">MEDIA KIT 2026</p>
                <div style="margin-top:40px; font-size:30px;">TOTAL VIEWS: ${views.toLocaleString()}</div>
            </div>`;
            html2pdf().from(h).save(`MediaKit_${usuarioAtivo}.pdf`);
        }

        // GLOBAL CONTROLS
        window.addEventListener('keydown', (e) => { if (e.code === "Space" && !document.getElementById('area-prompter').classList.contains('hidden')) { e.preventDefault(); togglePrompter(); } });

        window.onload = () => {
            if (usuarioAtivo) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('user-info').innerText = usuarioAtivo;
                document.getElementById('data-atual').innerText = new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
                mudarAba('dash');
            }
            lucide.createIcons();
        };
    </script>
</body>
</html>